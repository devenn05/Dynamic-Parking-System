
================================================================================
FILE: src\index.html
================================================================================

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ParkingSystemFrontend</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
</body>
</html>


================================================================================
FILE: src\main.server.ts
================================================================================

import { BootstrapContext, bootstrapApplication } from '@angular/platform-browser';
import { App } from './app/app';
import { config } from './app/app.config.server';

const bootstrap = (context: BootstrapContext) =>
    bootstrapApplication(App, config, context);

export default bootstrap;


================================================================================
FILE: src\main.ts
================================================================================

import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { App } from './app/app';

bootstrapApplication(App, appConfig)
  .catch((err) => console.error(err));


================================================================================
FILE: src\server.ts
================================================================================

import {
  AngularNodeAppEngine,
  createNodeRequestHandler,
  isMainModule,
  writeResponseToNodeResponse,
} from '@angular/ssr/node';
import express from 'express';
import { join } from 'node:path';

const browserDistFolder = join(import.meta.dirname, '../browser');

const app = express();
const angularApp = new AngularNodeAppEngine();

/**
 * Example Express Rest API endpoints can be defined here.
 * Uncomment and define endpoints as necessary.
 *
 * Example:
 * ```ts
 * app.get('/api/{*splat}', (req, res) => {
 *   // Handle API request
 * });
 * ```
 */

/**
 * Serve static files from /browser
 */
app.use(
  express.static(browserDistFolder, {
    maxAge: '1y',
    index: false,
    redirect: false,
  }),
);

/**
 * Handle all other requests by rendering the Angular application.
 */
app.use((req, res, next) => {
  angularApp
    .handle(req)
    .then((response) =>
      response ? writeResponseToNodeResponse(response, res) : next(),
    )
    .catch(next);
});

/**
 * Start the server if this module is the main entry point, or it is ran via PM2.
 * The server listens on the port defined by the `PORT` environment variable, or defaults to 4000.
 */
if (isMainModule(import.meta.url) || process.env['pm_id']) {
  const port = process.env['PORT'] || 4000;
  app.listen(port, (error) => {
    if (error) {
      throw error;
    }

    console.log(`Node Express server listening on http://localhost:${port}`);
  });
}

/**
 * Request handler used by the Angular CLI (for dev-server and during build) or Firebase Cloud Functions.
 */
export const reqHandler = createNodeRequestHandler(app);


================================================================================
FILE: src\styles.css
================================================================================

body{
    margin: 0;
}

/* =========================
   DARK MODE OVERRIDES
   ========================= */
body.dark-theme {
    background-color: #121212;
    color: #e0e0e0;
}

body.dark-theme nav {
    background-color: #000 !important;
    border-bottom: 1px solid #333;
}

body.dark-theme .card, 
body.dark-theme .dialog-box {
    background-color: #1e1e1e;
    border-color: #333;
    color: #e0e0e0;
}

body.dark-theme input, 
body.dark-theme select, 
body.dark-theme button {
    background-color: #2c2c2c;
    color: white;
    border: 1px solid #555;
}

body.dark-theme table {
    border-color: #444;
}
body.dark-theme th {
    background-color: #333;
    border-color: #444;
}
body.dark-theme td {
    border-color: #444;
}

/* Ensure headings stay readable */
body.dark-theme h2, 
body.dark-theme h3, 
body.dark-theme h4 {
    color: #fff;
}
body.dark-theme .card h1,h2,h3,h4,h5,h6{
    color: black;
}

body.dark-theme .ticket { background: #e6fffa; padding: 10px; border: 1px dashed #009977; margin-top: 10px; color: black;}
body.dark-theme .bill { background: #fff3cd; padding: 10px; border: 1px dashed #ffc107; margin-top: 10px; color: black }

================================================================================
FILE: src\app\app.config.server.ts
================================================================================

import { mergeApplicationConfig, ApplicationConfig } from '@angular/core';
import { provideServerRendering, withRoutes } from '@angular/ssr';
import { appConfig } from './app.config';
import { serverRoutes } from './app.routes.server';

const serverConfig: ApplicationConfig = {
  providers: [
    provideServerRendering(withRoutes(serverRoutes))
  ]
};

export const config = mergeApplicationConfig(appConfig, serverConfig);


================================================================================
FILE: src\app\app.config.ts
================================================================================

import { ApplicationConfig, provideBrowserGlobalErrorListeners } from '@angular/core';
import { provideRouter } from '@angular/router';
import {provideHttpClient} from '@angular/common/http';
import { routes } from './app.routes';
import { provideClientHydration, withEventReplay } from '@angular/platform-browser';

export const appConfig: ApplicationConfig = {
  providers: [
    provideBrowserGlobalErrorListeners(),

    // Registers the router with the defined routes.
    provideRouter(routes), 
    
    provideClientHydration(withEventReplay()),

    // IMPORTANT: Enables HttpClient injection across the app.
    provideHttpClient()
  ]
};


================================================================================
FILE: src\app\app.css
================================================================================

/* Clean and Simple Styling per requirements */
.container { padding: 20px; font-family: Arial, sans-serif; }
.card { border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin-bottom: 20px; background-color: #f9f9f9; }
.row { display: flex; gap: 20px; }
.column { flex: 1; }

/* Tables */
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { padding: 8px; text-align: left; }
th { background-color: #007bff; color: white; }

/* Forms */
input, select { padding: 8px; margin: 5px 0 10px 0; width: 100%; box-sizing: border-box; }
button { padding: 10px 15px; background-color: #28a745; color: white; border: 1px; cursor: pointer; }
.exit-btn { background-color: #dc3545; }
button:hover { opacity: 0.9; }

/* Status */
.error { color: red; font-weight: bold; padding: 10px; margin-bottom: 20px; background: #ffe6e6; }
.ticket { background: #e6fffa; padding: 10px; border: 1px dashed #009977; margin-top: 10px; }
.bill { background: #fff3cd; padding: 10px; border: 1px dashed #ffc107; margin-top: 10px; }

/* Tabs */
.tabs button { margin-right: 5px; background: #ddd; color: #333; }
.tabs button.active { background: #007bff; color: white; }

================================================================================
FILE: src\app\app.html
================================================================================

<!-- 
  GLOBAL NAVIGATION BAR 
  Present on all pages. Uses 'routerLink' to navigate without page reloads.
-->
<nav style="background: #333; padding: 15px; color: white;">
  <span style="font-weight: bold; margin-right: 20px;">Parking System</span>
  <a routerLink="/operations" style="color: white; margin-right: 15px; text-decoration: none;">Entry/Exit</a>
  <a routerLink="/lots" style="color: white; margin-right: 15px; text-decoration: none;">Manage Lots</a>
  <a routerLink="/sessions" style="color: white; text-decoration: none;">Sessions</a>

  <button (click)="toggleTheme()" style="padding: 5px 10px; font-size: 12px; cursor: pointer; margin-left: 10px; background-color: transparent;">
    {{ isDarkMode() ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode' }}
  </button>

</nav>

<router-outlet></router-outlet>

================================================================================
FILE: src\app\app.routes.server.ts
================================================================================

import { RenderMode, ServerRoute } from '@angular/ssr';

export const serverRoutes: ServerRoute[] = [
  {
    path: '**',
    renderMode: RenderMode.Prerender
  }
];


================================================================================
FILE: src\app\app.routes.ts
================================================================================

import { Routes } from '@angular/router';
import { ParkingLotList } from './components/parking-lot-list/parking-lot-list';
import { Component } from '@angular/compiler';
import { ParkingOperations } from './components/parking-operations/parking-operations';
import { ParkingSessions } from './components/parking-sessions/parking-sessions';

/**
 * Route Configuration
 * Defines the navigation paths for the application.
 */

export const routes: Routes = [
    // Redirect empty path to the Operations dashboard (default view)
    { path: '', redirectTo: 'operations', pathMatch: 'full' },

    // 'Manage Lots' Screen - Create & List Parking Lots
    {path: 'lots', component: ParkingLotList},

    // 'Entry/Exit' Screen - Handle vehicle processing
    {path: 'operations', component: ParkingOperations},

    // 'Sessions' Screen - View History and Active vehicles
    {path: 'sessions', component: ParkingSessions}
];


================================================================================
FILE: src\app\app.spec.ts
================================================================================

import { TestBed } from '@angular/core/testing';
import { App } from './app';

describe('App', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [App],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(App);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });
});


================================================================================
FILE: src\app\app.ts
================================================================================

import { DOCUMENT, isPlatformBrowser } from '@angular/common';
import { Component, Inject, OnInit, PLATFORM_ID, signal } from '@angular/core';
import { RouterOutlet, RouterLink  } from '@angular/router';

/**
 * Root Application Component
 * -------------------------------------------------------------------------
 * Acts as the shell for the application.
 * Contains the Global Navigation Bar and the Router Outlet.
 */

@Component({
  selector: 'app-root',
  imports: [RouterOutlet, RouterLink ],
  templateUrl: './app.html',
  styleUrl: './app.css'
})
export class App implements OnInit {
  isDarkMode = signal<boolean>(false);

  constructor(
    @Inject(DOCUMENT) private document: Document,
    @Inject(PLATFORM_ID) private platformId: Object // <--- Inject Platform ID
  ) {}

  ngOnInit() {
    // Check LocalStorage to remember preference
    if (isPlatformBrowser(this.platformId)) {
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') {
        this.toggleTheme(true);
      }
    }
  }

  toggleTheme(forceDark?: boolean) {
    const newState = forceDark ?? !this.isDarkMode();
    
    this.isDarkMode.set(newState);
    
    if (newState) {
      this.document.body.classList.add('dark-theme');
      
      // Only write to localStorage if in Browser
      if (isPlatformBrowser(this.platformId)) {
        localStorage.setItem('theme', 'dark');
      }
    } else {
      this.document.body.classList.remove('dark-theme');
      
      // Only write to localStorage if in Browser
      if (isPlatformBrowser(this.platformId)) {
        localStorage.setItem('theme', 'light');
      }
    }
  }
}

================================================================================
FILE: src\app\components\parking-lot-list\parking-lot-list.css
================================================================================



================================================================================
FILE: src\app\components\parking-lot-list\parking-lot-list.html
================================================================================

<div class="container">
  
  <!-- Dynamic Title -->
  <h2>{{ isEditing() ? 'Update Parking Lot' : 'Manage Parking Lots' }}</h2>

  <div *ngIf="errorMessage()" class="error">
    {{ errorMessage() }}
  </div>

  <!-- Creation / Editing Form -->
  <div class="card" [style.border]="isEditing() ? '2px solid orange' : '1px solid #ccc'">
    <h3>{{ isEditing() ? 'Editing Lot #' + editingId() : 'Create New Lot' }}</h3>
    
    <form #lotForm="ngForm">
      
      <!-- Inputs remain same, but we bind them to the shared 'newLot' object -->
      <input type="text" [(ngModel)]="newLot.name" name="name" placeholder="Lot Name" required>
      <input type="text" [(ngModel)]="newLot.location" name="location" placeholder="Location" required>
      
      <!-- Helper text for slots -->
      <small *ngIf="isEditing()" style="color: red;">* Warning: You can increase slots, but cannot decrease them.</small>
      <input type="number" [(ngModel)]="newLot.totalSlots" name="slots" placeholder="Total Slots" required min="1">
      
      <input type="number" [(ngModel)]="newLot.basePricePerHour" name="price" placeholder="Base Price/Hr" required min="1">
      
      <div style="margin-top: 10px;">
          
          <!-- Button: Shows ONLY if NOT editing -->
          <button *ngIf="!isEditing()" 
                  (click)="createLot()" 
                  type="button" 
                  [disabled]="!lotForm.valid"
                  [style.opacity]="!lotForm.valid ? '0.5' : '1'">
            Create Lot
          </button>

          <!-- Buttons: Show ONLY if editing -->
          <button *ngIf="isEditing()" 
                  (click)="updateCurrentLot()" 
                  type="button" 
                  style="background-color: orange; color: black; margin-right: 10px;">
            Update Lot
          </button>

          <button *ngIf="isEditing()" 
                  (click)="cancelEdit()" 
                  type="button" 
                  style="background-color: grey;">
            Cancel
          </button>

      </div>
    </form>
  </div>

  <!-- List Table -->
  <table style="border: 1">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Location</th>
        <th>Availability</th>
        <th>Price/Hr</th>
        <th>Action</th> 
      </tr>
    </thead>
    <tbody>
  
      <tr *ngFor="let lot of lots()">
        <td>{{ lot.id }}</td>
        <td>{{ lot.name }}</td>
        <td>{{ lot.location }}</td>
        <td>{{ lot.availableSlots }} / {{ lot.totalSlots }}</td>
        <td>{{ lot.basePricePerHour }}</td>
        
        <!-- Action Cell with Edit Button -->
        <td style="text-align: center;"> 
            <!-- This calls the new function startEdit() -->
            <button (click)="startEdit(lot)" style="font-size: 12px; padding: 5px;">
              Edit
            </button>
        </td>

      </tr>
    </tbody>
  </table>
</div>

================================================================================
FILE: src\app\components\parking-lot-list\parking-lot-list.spec.ts
================================================================================

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ParkingLotList } from './parking-lot-list';

describe('ParkingLotList', () => {
  let component: ParkingLotList;
  let fixture: ComponentFixture<ParkingLotList>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ParkingLotList]
    })
    .compileComponents();

    fixture = TestBed.createComponent(ParkingLotList);
    component = fixture.componentInstance;
    await fixture.whenStable();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


================================================================================
FILE: src\app\components\parking-lot-list\parking-lot-list.ts
================================================================================

import { Component, OnInit, NgZone, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ParkingService } from '../../services/parking';
import { ParkingLot } from '../../models/models.interface';

/**
 * Parking Lot List Component
 * -------------------------------------------------------------------------
 * This is the Admin Dashboard.
 * Capabilities:
 * 1. Create new Parking Lots (POST).
 * 2. View all Parking Lots and their stats (GET).
 */

@Component({
  selector: 'app-parking-lot-list',
  imports: [FormsModule, CommonModule],
  templateUrl: './parking-lot-list.html',
  styleUrl: '../../app.css',
})
export class ParkingLotList implements OnInit {

  // List of lots fetched from serve
  lots = signal<ParkingLot[]>([])

  errorMessage = signal<string>("")

  //State for Editing
  isEditing = signal<boolean>(false);
  editingId = signal<number | null>(null);

  //DTO for Creating a Lot
  newLot = {
    name: '', 
    location: '', 
    totalSlots: null as any, 
    basePricePerHour: null as any
  };

  constructor(private parkingService: ParkingService) {}

  ngOnInit(): void {
    this.loadLots();
  }

  // Fetches the latest list of lots from the API. 
  loadLots(){
    this.parkingService.getAllLots().subscribe(data => this.lots.set(data));
  }

  // Handles creation of a new parking lot.
  createLot(){

    // Confirmation Message box 
    if(!confirm("Confirm Lot entry?")) return;

    this.errorMessage.set("")
    this.parkingService.createLot(this.newLot).subscribe({
      next: () =>{

        // 1. Refresh the table data
        this.loadLots();

        // 2. Reset the form
        this.newLot = { name: '', location: '', totalSlots: null as any, basePricePerHour: null as any };

        // 3. Updates error message if Lot is added Succesfully.
        this.errorMessage.set("Lot added Successfully")
      },
      error: (err) =>{
          console.error("Backend Error:", err);
        if (err.error && err.error.message) {
            this.errorMessage.set(err.error.message);
        } else {
            this.errorMessage.set("Failed to create lot. Check inputs.");
        }
      }
    });
  }

  // 1. Called when you click "Edit" on a table row
  startEdit(lot: ParkingLot) {
    this.isEditing.set(true);      // Turn on Edit Mode
    this.editingId.set(lot.id);    // Remember which ID we are editing

    // Fill the form with that lot's data
    this.newLot = {
      name: lot.name,
      location: lot.location,
      totalSlots: lot.totalSlots,
      basePricePerHour: lot.basePricePerHour
    };
  }

  // 2. Called when you click "Update Lot" button
  updateCurrentLot() {
    if(!confirm("Confirm changes to this lot?")) return;

    const id = this.editingId();
    if (!id) return; // Safety check

    this.errorMessage.set("");
    
    // Call the new Service method
    this.parkingService.updateLot(id, this.newLot).subscribe({
      next: () => {
        this.loadLots();    // Refresh list
        this.cancelEdit();  // Reset form to normal
        this.errorMessage.set("Lot Updated Successfully");
      },
      error: (err) => {
         this.errorMessage.set(err.error?.message || "Update Failed");
      }
    });
  }

  // 3. Called when you click "Cancel"
  cancelEdit() {
    this.isEditing.set(false);
    this.editingId.set(null);
    // Clear form
    this.newLot = { name: '', location: '', totalSlots: null as any, basePricePerHour: null as any };
    this.errorMessage.set("");
  }

}


================================================================================
FILE: src\app\components\parking-operations\parking-operations.css
================================================================================



================================================================================
FILE: src\app\components\parking-operations\parking-operations.html
================================================================================

<div class="container">

  <!-- GLOBAL ERROR DISPLAY -->
  <div *ngIf="errorMessage()" class="error">
    {{ errorMessage() }}
  </div>

  <div class="row">

    <!-- ENTRY SECTION -->
    <div class="column" *ngIf="hasLots(); else noLots">
      <div class="card">
        <h3>Vehicle Entry</h3>

         <!-- ENTRY FORM -->
        <form (ngSubmit)="handleEntry()" #entryForm="ngForm">
          <label>Vehicle No (Strictly follow the pattern: MH12AB1234 or 22BH1234AA) </label>
          <input
            [ngModel]="entryData.vehicleNumber"
            (input)="formatVehicleNumber($event, 'ENTRY')" 
            name="vNum"
            placeholder="MH12AB1234"
            required
            [pattern]="vehiclePattern" 
          />
          <!-- Visual Hint if pattern doesn't match -->
           <div *ngIf="entryForm.controls['vNum']?.invalid && entryForm.controls['vNum']?.touched" style="color: red; font-size: 0.8em;">
             Invalid Format. Standard or BH series only.
           </div>

          <label>Type:</label>
          <select [(ngModel)]="entryData.vehicleType" name="vType" required>
            <option value="CAR">CAR</option>
            <option value="BIKE">BIKE</option>
          </select>

          <label>Parking Lot:</label>
          <select [(ngModel)]="entryData.parkingLotId" name="pLot" required>
            <option
              *ngFor="let lot of lots()"
              [value]="lot.id"
              [disabled]="lot.availableSlots === 0"
            >
              {{ lot.name }} ({{ lot.availableSlots }} slots free)
            </option>
          </select>

          <button
            type="submit"
            [disabled]="!entryForm.valid"
            [style.opacity]="!entryForm.valid ? '0.5' : '1'"
          >
            Park Vehicle
          </button>
        </form>
        
        <!-- TICKET RECEIPT DISPLAY -->
        <!-- Only shows after successful entry -->
        <div *ngIf="ticket()" class="ticket">
          <h4 style="color: black;">‚úÖ TICKET ISSUED</h4>
          <p style="font-size: 0.9em; color: black; margin-bottom: 10px;">
            Token generated for <strong>{{ ticket()?.vehicleNumber }}</strong>. 
            <br><em>Please show this vehicle number at the exit.</em>
          </p>
          <hr style="border: 0; border-top: 1px dashed #aaa;">
          
          <p>Slot: <strong>{{ ticket()?.slotNumber }}</strong></p>
          <p>Date: {{ ticket()?.entryTime | date:'mediumDate' }}</p>
          <p>Time: {{ ticket()?.entryTime | date:'shortTime' }}</p>
          <p>Lot: {{ ticket()?.parkingLotName }}</p>
        </div>
      </div>
    </div>

    <!-- NO LOTS FALLBACK -->
    <ng-template #noLots>
      <div class="column">
        <div class="card error">
          No parking lots available. Please create a parking lot first.
        </div>
      </div>
    </ng-template>

    <!-- EXIT SECTION -->
    <div class="column">
      <div class="card">
        <h3>Vehicle Exit</h3>

        <!-- EXIT FORM -->
        <form (ngSubmit)="handleExit()" #exitForm="ngForm">
          <label>Vehicle No:</label>
          <input
            [ngModel]="exitData.vehicleNumber"
            (input)="formatVehicleNumber($event, 'EXIT')"
            name="eVNum"
            placeholder="MH12AB1234"
            required
            [pattern]="vehiclePattern"
          />

          <button
            type="submit"
            class="exit-btn"
            [disabled]="!exitForm.valid"
            [style.opacity]="!exitForm.valid ? '0.5' : '1'"
          >
            Generate Bill
          </button>
        </form>

         <!-- BILL RECEIPT DISPLAY -->
        <div *ngIf="bill()" class="bill">
          <h4 style="color: black;">üßæ BILL GENERATED</h4>
          
          <p><strong>Total To Pay: ‚Çπ{{ bill()?.totalAmount }}</strong></p>
          
          <hr style="border: 0; border-top: 1px dashed black; margin: 15px 0;">
          
          <!-- CALCULATION EXPLANATION -->
          <div style="font-size: 0.9em; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 4px;">
             <p><strong>Calculation Logic:</strong></p>
             <p>Base Price: ‚Çπ{{bill()?.basePricePerHour}}/hr</p>
             <p>Duration: {{bill()?.duration}} mins 
                <span *ngIf="bill()?.duration! > 30"> (Including Free 30 minutes)</span>
             </p>
             
             <!-- Only show billing formula if amount > 0 -->
             <div *ngIf="bill()?.totalAmount! > 0; else freeParking">
                 <p>Billable Hours: {{ bill()?.billableHours }} hrs</p>
                 <p>Surge Multiplier: x{{ bill()?.occupancyMultiplier }} (Lot Occupancy)</p>
                 <hr style="margin: 5px 0">
                 <p><em>Formula: Hours x Base x Surge</em></p>
                 <p><strong>{{ bill()?.billableHours }} * {{ bill()?.basePricePerHour }} * {{ bill()?.occupancyMultiplier }} = ‚Çπ{{ bill()?.totalAmount }}</strong></p>
             </div>
             
             <ng-template #freeParking>
                 <p><strong>Status: FREE (Under 30 mins)</strong></p>
             </ng-template>
          </div>

          
          <p style="font-size: 0.8em; color: #666;">
            Entry Time: {{ bill()?.entryTime | date:'medium' }}
          </p>
          <p style="font-size: 0.8em; color: #666;">
            Exit Time: {{ bill()?.exitTime | date:'medium' }}
          </p>
        </div>
      </div>
    </div>

  </div>
</div>

================================================================================
FILE: src\app\components\parking-operations\parking-operations.spec.ts
================================================================================

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ParkingOperations } from './parking-operations';

describe('ParkingOperations', () => {
  let component: ParkingOperations;
  let fixture: ComponentFixture<ParkingOperations>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ParkingOperations]
    })
    .compileComponents();

    fixture = TestBed.createComponent(ParkingOperations);
    component = fixture.componentInstance;
    await fixture.whenStable();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


================================================================================
FILE: src\app\components\parking-operations\parking-operations.ts
================================================================================

import { Component, OnInit, signal  } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ParkingService } from '../../services/parking';
import { EntryRequest, ExitRequest, ParkingTicket, Bill, ParkingLot } from '../../models/models.interface';

/**
 * Parking Operations Component
 * -------------------------------------------------------------------------
 * This is the main "User Interface" for the gatekeeper.
 * It handles the two primary transactional workflows:
 * 1. Vehicle Entry -> Generates a Ticket.
 * 2. Vehicle Exit -> Generates a Bill.
 */

@Component({
  selector: 'app-parking-operations',
  imports: [CommonModule, FormsModule],
  templateUrl: './parking-operations.html',
  styleUrl: '../../app.css',
})
export class ParkingOperations implements OnInit {

   // To store available parking lots for the dropdown
  lots = signal<ParkingLot[]>([]);

  // State signal to check if we even have lots to show
  hasLots = signal<boolean>(true);

  constructor(private parkingService: ParkingService) {}
  
  // DTO for Entry Form Binding
  entryData: EntryRequest = {vehicleNumber: '', 
                  vehicleType: 'CAR',  
                  parkingLotId: 1
                };
  
  // DTO for Exit Form Binding
  exitData: ExitRequest = {vehicleNumber: ''};
  
  // Response signals to display results UI
  bill = signal<Bill | null>(null)
  ticket = signal<ParkingTicket | null>(null)
  errorMessage = signal<string>("")
  
  //  On Initializationit fetch all parking lots so we can populate the "Select Lot" dropdown for entry form.
  ngOnInit(): void {
    this.parkingService.getAllLots().subscribe(data=>{
      this.lots.set(data);
      this.hasLots.set(data.length > 0);

      // Auto-select the first lot if available
      if (this.lots().length > 0) this.entryData.parkingLotId = data[0].id;
    })
  }

  // SANITIZER: Formats input live
  // Called by (input)="formatVehicleNumber($event, 'ENTRY')"
  formatVehicleNumber(event: any, type: 'ENTRY' | 'EXIT') {
    let val = event.target.value.toUpperCase();
    
    // Remove anything that is NOT A-Z or 0-9
    val = val.replace(/[^A-Z0-9]/g, '');

    // Update the model
    if (type === 'ENTRY') {
      this.entryData.vehicleNumber = val;
    } else {
      this.exitData.vehicleNumber = val;
    }

    // Force update the input field visually (sometimes specific in Angular)
    event.target.value = val; 
  }

  // REGEX GETTER (For HTML Pattern Validation)
  // This matches the Java Regex exactly
  get vehiclePattern(): string {
    return "^([A-Z]{2}[0-9]{2}[A-Z]{0,3}[0-9]{4}|[0-9]{2}BH[0-9]{4}[A-Z]{1,2})$";
  }

  // Handles the 'Park Vehicle' form submission.
  handleEntry(){
    if(!confirm("Confirm vehicle Entry?")) return;
    this.ticket.set(null);
    this.errorMessage.set("");
    this.parkingService.entryVehicle(this.entryData).subscribe({
      next: (res) => this.ticket.set(res),
      error: (err) => this.errorMessage.set(err.error?.message || 'Error Occured')
    });
    
  }

  //Handles the 'Exit Vehicle' form submission.
  handleExit(){
    if(!confirm("Confirm vehicle Exit?")) return;
    this.bill.set(null)
    this.errorMessage.set("")
    this.parkingService.exitVehicle(this.exitData).subscribe({
      next: (res) =>this.bill.set(res),
      error: (err) => this.errorMessage.set(err.error?.message || 'Error Occured')
    });
  }
}


================================================================================
FILE: src\app\components\parking-sessions\parking-sessions.css
================================================================================



================================================================================
FILE: src\app\components\parking-sessions\parking-sessions.html
================================================================================

<div class="container">
  <h2>Parking Sessions</h2>
  
  <!-- CONTROLS ROW: Filters and Dropdown -->
  <div class="card" style="display: flex; gap: 20px; align-items: center; padding: 15px;">
    
    <!-- 1. Lot Filter -->
    <div style="flex: 1;">
      <label><strong>Lot: </strong></label>
      <select [ngModel]="selectedLotId()" (ngModelChange)="selectedLotId.set($event); loadData()">
        <option [ngValue]="null">-- Show All Lots --</option>
        <option *ngFor="let lot of lots()" [value]="lot.id">{{ lot.name }}</option>
      </select>
    </div>

    <!-- 2. [NEW] Vehicle Search -->
    <div style="flex: 1;">
       <label><strong>Search Vehicle: </strong></label>
       <input type="text" 
              [ngModel]="searchTerm()" 
              (ngModelChange)="searchTerm.set($event)" 
              placeholder="e.g. MH-12..." 
              style="margin-bottom: 0;"> 
              <!-- style adjustment removes default bottom margin defined in css -->
    </div>

    <!-- 3. [NEW] Date Filter -->
    <div style="flex: 1;">
        <label><strong>Filter Date: </strong></label>
        <input type="date" 
               [ngModel]="searchDate()" 
               (ngModelChange)="searchDate.set($event)"
               style="margin-bottom: 0;">
    </div>
    
    <!-- 4. Reset Button -->
    <button (click)="searchTerm.set(''); searchDate.set('')" style="background: grey; font-size: 12px;">
      Clear Filters
    </button>
  </div>

  <div class="tabs" style="margin-top: 20px;">
    <button (click)="view.set('ACTIVE')" [class.active]="view() === 'ACTIVE'">Current Active Vehicles</button>
    <button (click)="view.set('HISTORY')" [class.active]="view() === 'HISTORY'">History (All)</button>
  </div>

  <!-- TABLE 1: ACTIVE SESSIONS -->
  <table style="border: 1" *ngIf="view() === 'ACTIVE'">
    <thead>
      <tr>
        <th>Vehicle</th>
        <th>Vehicle Type</th>
        <th *ngIf="!selectedLotId()">Parking Lot</th> 
        <th>Slot</th>
        <th>Entry Time</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- [CHANGED] Loop over filteredActiveSessions instead of activeSession() -->
      <tr *ngFor="let s of filteredActiveSessions">
        <td>{{ s.vehicleNumber }}</td>
        <td>{{ s.vehicleType }}</td>
        <td *ngIf="!selectedLotId()">{{ s.parkingLotName }}</td>
        <td>{{ s.slotNumber }}</td>
        <td>{{ s.entryTime | date:'medium' }}</td>
        <td style="text-align: center;">
            <button 
                (click)="onTerminate(s)" 
                style="background-color: #dc3545; color: white; padding: 5px 10px; border: none; font-size: 12px; cursor: pointer;">
                Terminate
            </button>
        </td>
      </tr>
      
      <!-- Fallback if no results -->
      <tr *ngIf="filteredActiveSessions.length === 0">
        <td colspan="6" style="text-align: center; padding: 20px; color: grey;">
           No vehicles match your search.
        </td>
      </tr>
    </tbody>
  </table>

  <!-- TABLE 2: HISTORY SESSIONS -->
  <table style="border: 1" *ngIf="view() === 'HISTORY'">
    <thead>
      <tr>
        <th>Vehicle</th>
        <th>Vehicle Type</th>
        <th *ngIf="!selectedLotId()">Parking Lot</th>
        <th>Slot</th>
        <th>Entry</th>
        <th>Exit</th>
        <th>Bill</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <!-- [CHANGED] Loop over filteredHistorySessions instead of historySession() -->
      <tr *ngFor="let s of filteredHistorySessions">
        <td>{{ s.vehicleNumber }}</td>
        <td>{{ s.vehicleType }}</td>
        <td *ngIf="!selectedLotId()">{{ s.parkingLotName }}</td>
        <td>{{ s.slotNumber }}</td>
        <td>{{ s.entryTime | date:'short' }}</td>
        <td>{{ s.exitTime | date:'short' }}</td>
        
        <!-- Logic for Bill Column -->
        <td [style.color]="s.totalAmount === 0 && s.status !== 'TERMINATED' ? 'green' : 'inherit'"
            [style.fontWeight]="s.totalAmount === 0 && s.status !== 'TERMINATED' ? 'bold' : 'normal'">
            {{ s.totalAmount === 0 ? (s.status === 'TERMINATED' ? '-' : 'FREE') : (s.totalAmount ? '‚Çπ' + s.totalAmount : '-') }}
        </td>

        <td>{{ s.status }}</td>
      </tr>

      <!-- Fallback if no results -->
      <tr *ngIf="filteredHistorySessions.length === 0">
        <td colspan="8" style="text-align: center; padding: 20px; color: grey;">
           No history found for these filters.
        </td>
      </tr>
    </tbody>
  </table>
</div>

================================================================================
FILE: src\app\components\parking-sessions\parking-sessions.spec.ts
================================================================================

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ParkingSessions } from './parking-sessions';

describe('ParkingSessions', () => {
  let component: ParkingSessions;
  let fixture: ComponentFixture<ParkingSessions>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ParkingSessions]
    })
    .compileComponents();

    fixture = TestBed.createComponent(ParkingSessions);
    component = fixture.componentInstance;
    await fixture.whenStable();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


================================================================================
FILE: src\app\components\parking-sessions\parking-sessions.ts
================================================================================

import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ParkingService } from '../../services/parking';
import { FormsModule } from '@angular/forms';
import { ParkingSession, ParkingLot } from '../../models/models.interface';

/**
 * Parking Sessions Component
 * -------------------------------------------------------------------------
 * Displays lists of vehicles in the system.
 * Features:
 * 1. "Active" Tab: Shows vehicles currently inside the parking lots.
 * 2. "History" Tab: Shows a complete log of all past and present sessions.
 * 3. Lot Filter: Allows narrowing down data by a specific Parking Lot.
 */

@Component({
  selector: 'app-parking-sessions',
  imports: [CommonModule, FormsModule],
  templateUrl: './parking-sessions.html',
  styleUrl: '../../app.css',
})
export class ParkingSessions implements OnInit {
  
  // Data Signals for the tables
  activeSession = signal<ParkingSession[]>([])
  historySession = signal<ParkingSession[]>([])

  // UI State: Toggle between 'ACTIVE' view and 'HISTORY' view
  view = signal<'ACTIVE' | 'HISTORY'>('ACTIVE');
  
  switchToActive() {
    this.view.set('ACTIVE');
  }

  switchToHistory() {
    this.view.set('HISTORY');
  }

  // Data for the Filter Dropdown
  lots = signal<ParkingLot[]>([])

  // Selected Lot ID for filtering (null = Show All)
  selectedLotId = signal<number | null>(null)

  constructor(private parkingService: ParkingService){}

  ngOnInit(): void {
    // 1. Fetch Lots first to populate the dropdown
    this.parkingService.getAllLots().subscribe(data => {
      this.lots.set(data);
      this.loadData();
    });
  }

  loadData(){
    // Fetch Active Sessions 
    this.parkingService.getActiveSessions(this.selectedLotId() || undefined)
        .subscribe(data => this.activeSession.set(data));

     // Fetch History
    this.parkingService.getAllSessions(this.selectedLotId() || undefined)
        .subscribe(data => this.historySession.set(data));
  }

   // 1. Search State Variables
  searchTerm = signal<string>(''); // For Vehicle Number
  searchDate = signal<string>(''); // For Date (YYYY-MM-DD)

  // 2. Filter Logic Helpers
  // We use standard "Getters". In Angular, using a getter in the template
  // automatically updates the view when the data changes.

  get filteredActiveSessions() {
    return this.activeSession().filter(s => this.matchesFilters(s));
  }

  get filteredHistorySessions() {
    return this.historySession().filter(s => this.matchesFilters(s));
  }

  // Core Matching Logic
  private matchesFilters(session: any): boolean {
    // 1. Check Vehicle Number (Case insensitive)
    const matchesVehicle = session.vehicleNumber.toLowerCase()
                           .includes(this.searchTerm().toLowerCase());
    
    // 2. Check Date (Compare YYYY-MM-DD strings)
    // entryTime is ISO (e.g., "2024-02-01T10:00:00")
    // searchDate is YYYY-MM-DD
    const matchesDate = !this.searchDate() || session.entryTime.startsWith(this.searchDate());

    return matchesVehicle && matchesDate;
  }

  onTerminate(session: any){

    // Confirmation message to Terminate the slot.
    const confirmMsg = `MANUAL OVERRIDE:\nAre you sure you want to forcibly terminate the session for vehicle: ${session.vehicleNumber}?\n\nThis will mark the slot as free and set the bill to 0.`;
    if(!confirm(confirmMsg)) return;

    this.parkingService.terminateSession(session.sessionId).subscribe({
      next: () => {
        alert("Session Terminated Successfully.");
        this.loadData(); 
      },
      error: (err) => alert("Failed to terminate: " + (err.error?.message || "Unknown error"))
    })
  }

}

================================================================================
FILE: src\app\models\models.interface.ts
================================================================================

// -------------------------------------------------------------------------
// DOMAIN MODELS / DTOS
// These interfaces define the shape of data exchanged with the Spring Boot API.
// They must strictly match the JSON structure returned by the Java DTOs.
// -------------------------------------------------------------------------


// Matches: ParkingLotDTO
export interface ParkingLot{
    id: number;
    name: string;
    location: string;
    totalSlots: number;
    availableSlots: number;
    basePricePerHour: number;
    createdAt: string;
}

//  Matches: ParkingSlotDTO
export interface ParkingSlot{
    id: number;
    slotNumber: number;
    slotStatus: 'AVAILABLE' | 'OCCUPIED';
}

//Matches: EntryRequest
// Sent when a vehicle attempts to enter.
export interface EntryRequest{
    vehicleNumber: string;
    vehicleType: 'CAR' | 'BIKE';
    parkingLotId: number;
}

// Matches: ExitRequest
// Sent when a vehicle attempts to exit.
export interface ExitRequest{
    vehicleNumber: string;
}

// Response received after a successful entry.
// Matches: ParkingTicketDTO
export interface ParkingTicket{
    sessionId: number;
    vehicleNumber: string;
    slotNumber: number;
    parkingLotName: string;
    entryTime: string;
}

// Response received after a successful exit.
// Matches: BillDTO
export interface Bill{
    sessionId: number;
    vehicleNumber: string;
    entryTime: string;
    exitTime: string;
    duration: number;
    totalAmount: number;
    parkingLotName: string;
    basePricePerHour: number;
    occupancyMultiplier: number;
    billableHours: number;
}

// Matches: ParkingSessionDTO (Java)
export interface ParkingSession{
    sessionId: number;
    vehicleNumber: string;
    vehicleType: string;
    parkingLotName?: string;
    slotNumber: number;
    entryTime: string;
    exitTime?: string;
    totalAmount?: number;
    status: 'ACTIVE' | 'COMPLETED' | 'TERMINATED';
}

================================================================================
FILE: src\app\services\parking.spec.ts
================================================================================

import { TestBed } from '@angular/core/testing';

import { Parking } from './parking';

describe('Parking', () => {
  let service: Parking;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(Parking);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


================================================================================
FILE: src\app\services\parking.ts
================================================================================

import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { ParkingLot, ParkingSlot,EntryRequest,ExitRequest,ParkingTicket, Bill, ParkingSession } from '../models/models.interface';
import { HttpClient } from '@angular/common/http';

/**
 * Parking Service
 * -------------------------------------------------------------------------
 * Acts as the bridge between the Angular Frontend and Spring Boot Backend.
 * Contains methods for all HTTP API calls defined in the requirements.
 */

@Injectable({
  providedIn: 'root',
})
export class ParkingService {
  
  // Base URL pointing to the local Spring Boot Server
  private baseUrl = 'http://localhost:8080/api'

  constructor(private http: HttpClient){}

  // -----------------------------------------------------------------------
  // PARKING LOT MANAGEMENT API
  // -----------------------------------------------------------------------


  // GET /api/parking-lots
  // Retrieves all parking lots with current availability stats.
  getAllLots(): Observable<ParkingLot[]> {
    return this.http.get<ParkingLot[]>(`${this.baseUrl}/parking-lots`);
  }

  //POST /api/parking-lots
  //Creates a new parking lot configuration.
  createLot(lot: any): Observable<ParkingLot>{
    return this.http.post<ParkingLot>(`${this.baseUrl}/parking-lots`, lot)
  }

  // GET /api/parking-lots/{id}/slots
  // Fetches the grid of slots (Available/Occupied) for a specific lot.
  getSlots(lotId: number): Observable<ParkingSlot[]>{
    return this.http.get<ParkingSlot[]>(`${this.baseUrl}/parking-lots/${lotId}/slots`)
  }

  // PUT http://localhost:8080/api/parking-lots/{id}
  // Update Parking Lot
  updateLot(id: number, lotData: any): Observable<ParkingLot> {
    return this.http.put<ParkingLot>(`${this.baseUrl}/parking-lots/${id}`, lotData);
  }

  // POST /api/parking/entry
  // Triggers the entry logic (Vehicle Validation -> Slot Assignment -> Ticket Issue).
  entryVehicle(request: EntryRequest): Observable<ParkingTicket>{
    return this.http.post<ParkingTicket>(`${this.baseUrl}/parking/entry`, request)
  }

  // POST /api/parking/exit
  // Triggers the exit logic (Validation -> Bill Calculation -> Payment).
  exitVehicle(request: ExitRequest): Observable<Bill>{
    return this.http.post<Bill>(`${this.baseUrl}/parking/exit`, request)
  }

  // GET /api/sessions/active
  // Fetches only currently parked vehicles.
  getActiveSessions(lotId?: number): Observable<ParkingSession[]>{
    let url = `${this.baseUrl}/sessions/active`;
    if (lotId) url += `?lotId=${lotId}`;
    return this.http.get<ParkingSession[]>(url);
  }

  // GET /api/sessions/history
  // Fetches all records (Active + Completed).
  getAllSessions(lotId?: number): Observable<ParkingSession[]>{
    let url = `${this.baseUrl}/sessions/history`;
    if (lotId) url += `?lotId=${lotId}`;
    return this.http.get<ParkingSession[]>(url);
  }

  // POST /api/sessions/{id}/terminate
  // Terminates the Session associated with that id
  terminateSession(sessionId: number): Observable<void>{
    return this.http.post<void>(`${this.baseUrl}/sessions/${sessionId}/terminate`, {});
  }

}

================================================================================
FILE: README.md
================================================================================


# Dynamic Pricing System for Parking Lots (Frontend)

## 1. Project Overview

This is a functional, minimal-UI Angular application that serves as the frontend for the **Dynamic Pricing System for Parking Lots**. It interacts with the backend via REST APIs to provide a simple and effective user interface for managing parking operations.

As per the requirements, the focus is on functionality and clarity over complex styling. The application is built as a Single Page Application (SPA).

---

## 2. Tech Stack

-   **Angular 21.1.2**
-   **TypeScript**
-   **HTML**
-   **CSS** (No heavy UI frameworks)
-   **Angular CLI**

---

## 3. Screens & Features

The UI is divided into three main screens, accessible via the top navigation bar.

#### 1. Entry/Exit (`/operations`)
This is the default and primary screen for daily operations.
-   **Vehicle Entry:** A form to input a vehicle's number and type, and select a parking lot. On successful entry, a **Ticket** is displayed showing the assigned slot number.
-   **Vehicle Exit:** A form to input a vehicle's number. On successful exit, a **Bill** is displayed with the total duration and calculated fee.
-   Error messages from the backend (e.g., "Lot is full", "Vehicle not found") are displayed clearly.

#### 2. Manage Lots (`/lots`)
This screen serves as the administrative panel for managing parking facilities.
-   **Create Lot:** A form to define a new parking lot with its name, location, total capacity, and base hourly price.
-   **Lot List:** A table that displays all existing parking lots, including their real-time occupancy (`Available Slots / Total Slots`).

#### 3. Sessions (`/sessions`)
This screen is a dashboard for viewing vehicle data.
-   **Tabs:** Allows toggling between `Current Active Vehicles` and `History (All)`.
-   **Filter:** A dropdown menu to filter the data for a specific parking lot or show all lots.
-   **Active Table:** Shows details of vehicles currently inside a lot.
-   **History Table:** Provides a complete log of all sessions (both active and completed), showing entry/exit times and final bill amounts.

---

## 4. Assumptions Made

1.  **Backend Availability:** The application expects the Spring Boot backend API to be running and accessible at `http://localhost:8080`.
2.  **State Management:** The application uses component-level state and Angular Signals. No complex global state management library (like NgRx or Akita) is needed due to the simple nature of the UI.
3.  **Styling:** All styling is done with basic, clean CSS as specified. No component libraries like Angular Material or Bootstrap are used.

---

## 5. How to Run the Application

#### Prerequisites

-   Node.js (latest LTS version recommended).
-   Angular CLI installed globally: `npm install -g @angular/cli`.

#### Steps

1.  **Clone the repository:**
    ```sh
    git clone <repository-url>
    ```

2.  **Navigate to the frontend project directory:**
    ```sh
    cd path/to/frontend/parking-system-frontend
    ```

3.  **Install project dependencies:**
    ```sh
    npm install
    ```

4.  **Run the development server:**
    ```sh
    ng serve
    ```

5.  Open your browser and navigate to `http://localhost:4200/`. The application will automatically reload if you change any of the source files.