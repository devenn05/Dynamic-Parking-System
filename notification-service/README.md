# üîî Notification Service - Real-time Updates

This microservice acts as the **"Consumer"** in our architecture. It subscribes to **Apache Kafka** events generated by the Main Backend and pushes them instantly to connected clients (Frontend) using **Server-Sent Events (SSE)**.

---

## üèóÔ∏è Architecture & Purpose

This service decouples the "Notification Logic" from the main "Business Logic". It allows the main API to respond quickly (asynchronously) while this service handles the slower task of maintaining thousands of open HTTP connections (SSE) and pushing data.

### Workflow:
1.  **Subscribe:** Frontend clients connect to an SSE stream endpoint (e.g., `/subscribe/{lotId}`).
2.  **Wait:** The connection stays open (`keep-alive`).
3.  **Kafka Event:** Main Backend publishes a `LotUpdate`, `SessionEntry`, or `SlotChange` event.
4.  **Broadcast:** This service receives the event via Kafka Listener.
5.  **Push:** Data is immediately pushed to all open SSE connections subscribed to that Lot ID.

---

## ‚ö° Key Features

*   **Zero-latency UI:** Frontend users see updates instantly without polling or refreshing the page.
*   **Caching with Redis:** Current lot status is cached in **Upstash Redis** to ensure new clients get the *latest state* immediately upon connecting.
*   **Dedicated Scalability:** Handles high concurrency (many users watching a dashboard) independently of the transactional database load.

---

## üîå API Endpoints (SSE)

### 1. Subscribe to Lot Updates
| Method | Endpoint | Description |
| :--- | :--- | :--- |
| `GET` | `/api/stream/subscribe/{lotId}` | Connects a client to a specific Parking Lot stream. (Using `EventSource` in JS/Angular) |

### 2. Subscribe to Global Updates (Admin Dashboard)
| Method | Endpoint | Description |
| :--- | :--- | :--- |
| `GET` | `/api/stream/subscribe/0` | Used for Lot List page (Global registry updates). |

---

## ‚öôÔ∏è Configuration (`application.properties`)

To run this locally, you must configure your Kafka Consumer and Redis Cache.

```properties
# Server Port (Different from Main Backend)
server.port=8081

# Kafka Consumer Configuration (Consumes from Main Backend)
spring.kafka.bootstrap-servers=<YOUR_CONFLUENT_KAFKA_URL>
spring.kafka.consumer.group-id=notification-service-group
spring.kafka.consumer.auto-offset-reset=latest

# Redis Configuration (Upstash or Local)
spring.redis.host=<YOUR_UPSTASH_HOST>
spring.redis.port=6379
spring.redis.password=<YOUR_REDIS_PASSWORD>
spring.redis.ssl=true

# CORS Configuration (Reflects your Frontend URL)
app.frontend.url=http://localhost:4200

## 6. How to Run

1.  Clone repository.
2.  Ensure MySQL is running and configured in `application.properties`.
3.  Access to Kafka Broker (Confluent/Local) and Redis (Upstash/Local).
4.  Run: `mvn spring-boot:run`